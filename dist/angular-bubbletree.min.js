!function(e){e.module("angular-bubbletree.config",[]).value("angular-bubbletree.config",{debug:!0}),e.module("angular-bubbletree.directives",[]),e.module("angular-bubbletree.filters",[]),e.module("angular-bubbletree.services",[]),e.module("angular-bubbletree.controllers",[]),e.module("angular-bubbletree",["angular-bubbletree.config","angular-bubbletree.directives","angular-bubbletree.filters","angular-bubbletree.services","angular-bubbletree.controllers"])}(angular),function(){"use strict";function e(e,t){return{name:"bubbletree",scope:{datasource:"=",control:"="},restrict:"E",replace:!0,transclude:!1,link:function(r,a,l){function n(){var e;r.params={},e=l.id?r.params.id=l.id:r.params.id="bubbletree",e=l.width?r.params.width=l.width:r.params.width=1e3,e=l.height?r.params.height=l.height:r.params.height=400,e=l.linkDistance?r.params.linkDistance=l.linkDistance:r.params.linkDistance=100,e=l.enableTooltip?r.params.enableTooltip=r.$eval(l.enableTooltip):r.params.enableTooltip=!0,e=l.fillStyle&&["solid","gradient"].indexOf(l.fillStyle)>=0?r.params.fillStyle=l.fillStyle:r.params.fillStyle="gradient",e=l.parentColor?r.params.parentColor=l.parentColor:r.params.parentColor="#336699",e=l.childColor?r.params.childColor=l.childColor:r.params.childColor="#e0e0eb",e=l.collapsedColor?r.params.collapsedColor=l.collapsedColor:r.params.collapsedColor="#19334d",e=l.linkColor?r.params.linkColor=l.linkColor:r.params.linkColor="#9ecae1",e=l.textX?r.params.textX=l.textX:r.params.textX="1.45em",e=l.textY?r.params.textY=l.textY:r.params.textY="3.45em",e=l.scaleScore?r.params.scaleScore=l.scaleScore:r.params.scaleScore=10,c=d3.layout.force().linkDistance(r.params.linkDistance).charge(-120).gravity(.01).size([r.params.width,r.params.height]).on("tick",i),u=d3.select("#"+l.id).append("svg").attr("width",f).attr("height",g),p=u.selectAll(".btLink"),b=u.selectAll(".btNode"),r.params.enableTooltip&&(d=d3.select("#"+l.id).append("div").attr("class","btTooltip").style("opacity",0))}function o(){var e=t.flatten(m,h),a=d3.layout.tree().links(e);c.nodes(e).links(a).start(),p=p.data(a,function(e){return e.target.id}),p.exit().remove(),p.enter().insert("line",".btNode").attr("class","btLink"),r.params.linkColor&&p.attr("style","stroke:"+r.params.linkColor+";"),b=b.data(e,function(e){return e.id}),b.exit().remove();var l=b.enter().append("g").attr("class","btNode").on("click",s).call(c.drag);l.append("circle").on("mouseover",function(e){if(r.params.enableTooltip){d.transition().duration(1e3).style("opacity",.9);var t=d3.event.pageX,a=d3.event.pageY,l=e,n=l.size?l.size:"";d.html(l.name+"<br/>"+n).style("left",t-120+"px").style("top",a-12+"px")}}).on("mouseout",function(e){r.params.enableTooltip&&d.transition().duration(500).style("opacity",0)}).attr("r",function(e){var a=d3.min(h),l=d3.max(h);return t.linearScale(e.size,m,a,l,r.params.scaleScore)||10}),l.append("text").attr("dy",r.params.textY).attr("dx",r.params.textX).text(function(e){return e.name}),b.select("circle").style("fill",function(e){return"solid"===r.params.fillStyle?t.colorSolid(e,r.params):t.colorGradient(u,e,r.params)})}function i(){p.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),b.attr("transform",function(e){return"translate("+e.x+","+e.y+")"})}function s(e){d3.event.defaultPrevented||(e.children?(e._children=e.children,e.children=null):(e.children=e._children,e._children=null),o())}var c,u,d,p,b,m,f="100%",g="100%",h=[];r.internalCtrl=r.control||{},r.internalCtrl.bind=function(t){e.debug("Binding bubble tree chart"),t&&(m=t,o(),e.debug("Binding completed"))},n()}}}angular.module("angular-bubbletree").directive("bubbletree",e),e.$inject=["$log","bubbletreeSvc"]}(),function(){"use strict";function e(e){var t={};return t.linearScale=function(e,t,r,a,l){var n=d3.scale.linear().domain([r,a]).range([1*l,2*l]);return n(e)},t.flatten=function(e,t){function r(e){e.size&&t.push(e.size),e.children&&e.children.forEach(r),e.id||(e.id=++l),a.push(e)}var a=[],l=0;return r(e),a},t.colorSolid=function(e,t){return e._children?t.collapsedColor:e.children?t.parentColor:t.childColor},t.colorGradient=function(e,t){var r="#fff",a="btGradient",l=e.append("svg:defs").append("svg:linearGradient").attr("id",a).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%").attr("spreadMethod","pad");return l.append("svg:stop").attr("offset","0%").attr("stop-color","#999").attr("stop-opacity",1),l.append("svg:stop").attr("offset","100%").attr("stop-color",r).attr("stop-opacity",1),"url(#"+a+")"},t}angular.module("angular-bubbletree").service("bubbletreeSvc",e),e.$inject=["$log"]}();